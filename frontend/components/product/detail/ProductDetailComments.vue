<script setup lang="ts">
import { Swiper, SwiperSlide } from "swiper/vue";
import { Navigation, Autoplay } from "swiper/modules";
import type { Swiper as SwiperType } from "swiper";
import "swiper/css";
import "swiper/css/pagination";
import "swiper/css/navigation";
import { HeroIcons } from "~/assets/icons/types/hero-icons";

const swiperInstance = ref<SwiperType | null>(null);
const currentSlideIndex = ref(0);
const totalSlides = ref(0);

// –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ swiper –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
const onSwiper = (swiper: SwiperType) => {
  swiperInstance.value = swiper;
  totalSlides.value = swiper.slides.length;
};

// –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–º–µ–Ω–µ —Å–ª–∞–π–¥–∞
const onSlideChange = () => {
  currentSlideIndex.value = swiperInstance.value?.activeIndex || 0;
};

// –º–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
const goNext = () => swiperInstance.value?.slideNext();
const goPrev = () => swiperInstance.value?.slidePrev();

const comments = ref([
  {
    id: 1,
    name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    text: "–í—Å–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ! –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤–∑–æ—à–ª–æ –æ–∂–∏–¥–∞–Ω–∏—è, —Ç–∫–∞–Ω—å –ø—Ä–∏—è—Ç–Ω–∞—è –∫ —Ç–µ–ª—É, –Ω–µ –º–Ω–µ—Ç—Å—è. –ë—É–¥—É –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å –µ—â–µ!",
    advantages: "–û—Ç–ª–∏—á–Ω–æ —Å–∏–¥–∏—Ç",
    disadvantages: "–¶–µ–Ω–∞",
    rating: 5,
    date: "2 –¥–Ω—è –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 2,
    name: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞",
    text: "–ö–∞—á–µ—Å—Ç–≤–æ —Ç–∫–∞–Ω–∏ –ø–æ—Ä–∞–¥–æ–≤–∞–ª–æ, –ø—Ä–∏—è—Ç–Ω—ã–π —Ü–≤–µ—Ç, —Ö–æ—Ä–æ—à–æ —Ç—è–Ω–µ—Ç—Å—è. –û—á–µ–Ω—å –¥–æ–≤–æ–ª—å–Ω–∞ –ø–æ–∫—É–ø–∫–æ–π!",
    advantages: "–ú—è–≥–∫–∞—è –∏ –ø—Ä–∏—è—Ç–Ω–∞—è —Ç–∫–∞–Ω—å",
    disadvantages: "–î–æ–ª–≥–æ –∂–¥–∞–ª–∞ –¥–æ—Å—Ç–∞–≤–∫—É",
    rating: 4,
    date: "1 –Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 3,
    name: "–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤",
    text: "–†–∞–∑–º–µ—Ä —Å–æ–≤–ø–∞–ª –∏–¥–µ–∞–ª—å–Ω–æ, –∫–∞–∫ –ø–æ –º–µ—Ä–∫–∞–º. –°–∏–¥–∏—Ç –∫–∞–∫ –≤–ª–∏—Ç–æ–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é!",
    advantages: "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º–µ—Ä—É",
    disadvantages: "–ù–µ—Ç —è—Ä–∫–∏—Ö —Ä–∞—Å—Ü–≤–µ—Ç–æ–∫",
    rating: 5,
    date: "3 –¥–Ω—è –Ω–∞–∑–∞–¥",
    verified: false,
  },
  {
    id: 4,
    name: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞",
    text: "–°—Ç–∏–ª—å–Ω–∞—è –∏ —É–¥–æ–±–Ω–∞—è –æ–¥–µ–∂–¥–∞ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Å–∫–∏. –ù–æ—Å–∏—Ç—Å—è —Ö–æ—Ä–æ—à–æ, –Ω–µ –≤—ã—Ü–≤–µ—Ç–∞–µ—Ç.",
    advantages: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç",
    disadvantages: "–°–∫–æ–ª—å–∑–∏—Ç –Ω–∞ –≥–ª–∞–¥–∫–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏",
    rating: 4,
    date: "2 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 5,
    name: "–î–º–∏—Ç—Ä–∏–π –û—Ä–ª–æ–≤",
    text: "–¢–æ–≤–∞—Ä —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é –Ω–∞ 100%. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ö–æ—Ä–æ—à–∏–π –ø–æ—à–∏–≤.",
    advantages: "–ü—Ä–∏—è—Ç–Ω–∞—è —Ü–µ–Ω–∞",
    disadvantages: "–®–≤—ã –Ω–µ–º–Ω–æ–≥–æ —Ç–æ—Ä—á–∞—Ç",
    rating: 4,
    date: "5 –¥–Ω–µ–π –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 6,
    name: "–û–ª—å–≥–∞ –°–æ–∫–æ–ª–æ–≤–∞",
    text: "–•–æ—Ä–æ—à–æ –ø–æ–¥–æ—à–ª–æ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫. –ü–æ–ª—É—á–∞—Ç–µ–ª—å –±—ã–ª –¥–æ–≤–æ–ª–µ–Ω, –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç–∏–ª—å–Ω–æ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.",
    advantages: "–ö—Ä–∞—Å–∏–≤—ã–π —Ü–≤–µ—Ç",
    disadvantages: "–ù–µ –æ—á–µ–Ω—å –ø–ª–æ—Ç–Ω–∞—è —Ç–∫–∞–Ω—å",
    rating: 3,
    date: "1 –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥",
    verified: false,
  },
  {
    id: 7,
    name: "–ù–∏–∫–∏—Ç–∞ –í–æ–ª–∫–æ–≤",
    text: "–°—É–ø–µ—Ä –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—é –∫ –ø–æ–∫—É–ø–∫–µ, –Ω–µ –ø–æ–∂–∞–ª–µ–µ—Ç–µ!",
    advantages: "–ù–∞–¥—ë–∂–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª",
    disadvantages: "–ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–∞–∑–º–µ—Ä–∞ XL",
    rating: 5,
    date: "2 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 8,
    name: "–ê–ª–∏–Ω–∞ –§–µ–¥–æ—Ä–æ–≤–∞",
    text: "–û—á–µ–Ω—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –Ω–æ—Å–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –ù–µ —Å–∫–æ–≤—ã–≤–∞–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è, –ø—Ä–∏—è—Ç–Ω–∞—è —Ç–∫–∞–Ω—å.",
    advantages: "–£–¥–æ–±–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞",
    disadvantages: "–¶–≤–µ—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ñ–æ—Ç–æ",
    rating: 4,
    date: "3 –¥–Ω—è –Ω–∞–∑–∞–¥",
    verified: true,
  },
  {
    id: 9,
    name: "–°–µ—Ä–≥–µ–π –ü–∞–≤–ª–æ–≤",
    text: "–ü–æ–∫—É–ø–∫–æ–π –¥–æ–≤–æ–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –≤—ã—Å–æ—Ç–µ.",
    advantages: "–ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∏—Ä–∫–∞, –Ω–µ —Å–∞–¥–∏—Ç—Å—è",
    disadvantages: "–ú–∞–ª–µ–Ω—å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π",
    rating: 5,
    date: "1 –Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥",
    verified: false,
  },
  {
    id: 10,
    name: "–ï–ª–µ–Ω–∞ –ù–∏–∫–∏—Ç–∏–Ω–∞",
    text: "–ó–∞–∫–∞–∑ –ø—Ä–∏—à—ë–ª –±—ã—Å—Ç—Ä–æ, —É–ø–∞–∫–æ–≤–∫–∞ —Ü–µ–ª–∞—è. –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω—ã–π –Ω–∞ –æ—â—É–ø—å –º–∞—Ç–µ—Ä–∏–∞–ª.",
    advantages: "–ö—Ä–∞—Å–∏–≤–æ —Å–º–æ—Ç—Ä–∏—Ç—Å—è",
    disadvantages: "–¢–∫–∞–Ω—å –º–æ–≥–ª–∞ –±—ã –±—ã—Ç—å –ø–ª–æ—Ç–Ω–µ–µ",
    rating: 4,
    date: "4 –¥–Ω—è –Ω–∞–∑–∞–¥",
    verified: true,
  },
]);

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–≤–µ–∑–¥ —Ä–µ–π—Ç–∏–Ω–≥–∞
const generateStars = (rating: number) => {
  return Array.from({ length: 5 }, (_, i) => i < rating);
};
</script>

<template>
  <div class="comments-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">–û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h2>
        <div class="section-subtitle">–ß—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –Ω–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã –æ —Ç–æ–≤–∞—Ä–µ</div>
      </div>

      <div class="swiper-container">
        <button
          aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–∞–π–¥"
          class="swiper-button swiper-btn-prev"
          @click="goPrev"
        >
          <Icon
            :name="HeroIcons.ARROW_LEFT_SOLID"
            class="swiper-button--icon"
          />
        </button>
        <Swiper
          class="swiper-wrapper"
          :modules="[Navigation, Autoplay]"
          :autoplay="{ delay: 4000, disableOnInteraction: false }"
          :slides-per-view="4"
          :space-between="24"
          :loop="true"
          :navigation="{
            nextEl: '.swiper-btn-next',
            prevEl: '.swiper-btn-prev',
          }"
          :breakpoints="{
            320: { slidesPerView: 1, spaceBetween: 16 },
            480: { slidesPerView: 1.2, spaceBetween: 16 },
            640: { slidesPerView: 2, spaceBetween: 20 },
            768: { slidesPerView: 2.5, spaceBetween: 20 },
            1024: { slidesPerView: 3, spaceBetween: 24 },
            1280: { slidesPerView: 4, spaceBetween: 24 },
          }"
          @slide-change="onSlideChange"
          @swiper="onSwiper"
        >
          <SwiperSlide
            v-for="comment in comments"
            :key="comment.id"
            class="swiper-slide"
          >
            <div class="comment-card">
              <div class="comment-card__header">
                <div class="user-info">
                  <div class="user-avatar">
                    {{ comment.name.charAt(0) }}
                  </div>
                  <div class="user-details">
                    <div class="user-name">
                      {{ comment.name }}
                      <span
                        v-if="comment.verified"
                        class="verified-badge"
                        title="–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å"
                      >
                        ‚úì
                      </span>
                    </div>
                    <div class="comment-date">{{ comment.date }}</div>
                  </div>
                </div>

                <div class="rating-display">
                  <div class="stars">
                    <Star
                      v-for="(filled, index) in generateStars(comment.rating)"
                      :key="index"
                      :size="16"
                      :class="['star', filled ? 'filled' : 'empty']"
                    />
                  </div>
                  <div class="rating-value">{{ comment.rating }}/5</div>
                </div>
              </div>

              <div class="comment-card__content">
                <p class="comment-text">{{ comment.text }}</p>

                <div class="pros-cons">
                  <div class="pros">
                    <span class="label positive">üëç –ü–ª—é—Å—ã:</span>
                    <span class="value">{{ comment.advantages }}</span>
                  </div>
                  <div class="cons">
                    <span class="label negative">üëé –ú–∏–Ω—É—Å—ã:</span>
                    <span class="value">{{ comment.disadvantages }}</span>
                  </div>
                </div>
              </div>

              <div class="comment-card__footer">
                <button class="helpful-btn">
                  <span>–ü–æ–ª–µ–∑–Ω–æ?</span>
                  <span class="count">12</span>
                </button>
                <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
              </div>
            </div>
          </SwiperSlide>
        </Swiper>
        <button
          class="swiper-button swiper-btn-next"
          aria-label="–°–ª–µ–¥—É—é—â–∏–π —Å–ª–∞–π–¥"
          @click="goNext"
        >
          <Icon
            :name="HeroIcons.ARROW_RIGHT_SOLID"
            class="swiper-button--icon"
          />
        </button>
      </div>
      <BaseButton
        class="comments-section__all-views"
        size="lg"
        :outline="true"
        label="–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã"
      />
    </div>
  </div>
</template>

<style scoped lang="scss">
.swiper-button {
  position: absolute;
  top: 50%;

  z-index: 20;

  cursor: pointer;
  padding: 8px 12px;
  background-color: $accent-dark;
  color: #fff;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease;

  &:hover {
    background-color: $accent;
  }

  &--icon {
    font-size: 26px;
  }
}

.swiper-btn-prev {
  left: -70px;
}

.swiper-btn-next {
  right: -70px;
}

.comments-section {
  padding: 80px 0;
  position: relative;

  &__all-views {
    margin-inline: auto;
  }
}

.section-header {
  text-align: center;
  margin-bottom: 48px;
}

.section-title {
  font-size: 2.5rem;
  font-weight: 800;
  background: linear-gradient(135deg, #0f172a 0%, #475569 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 12px;
  letter-spacing: -0.025em;
}

.section-subtitle {
  font-size: 1.125rem;
  color: #64748b;
  font-weight: 500;
}

.swiper-container {
  position: relative;
  margin: 0 -12px;
  padding: 0 12px;
}

.swiper-wrapper {
  padding: 20px 0;
}

.comment-card {
  background: white;
  border-radius: 16px;
  padding: 24px;
  height: 100%;
  display: flex;
  flex-direction: column;
  border: 1px solid #e2e8f0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
      0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border-color: #cbd5e1;
  }
}

.comment-card__header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 20px;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: $accent;
  color: $white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 1.125rem;
}

.user-details {
  display: flex;
  flex-direction: column;
}

.user-name {
  font-weight: 600;
  color: #0f172a;
  display: flex;
  align-items: center;
  gap: 4px;
}

.verified-badge {
  color: #10b981;
  font-size: 0.875rem;
}

.comment-date {
  font-size: 0.875rem;
  color: #64748b;
}

.rating-display {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.stars {
  display: flex;
  gap: 2px;
}

.star.filled {
  fill: #fbbf24;
  stroke: #fbbf24;
}

.star.empty {
  fill: #e2e8f0;
  stroke: #cbd5e1;
}

.rating-value {
  font-size: 0.875rem;
  font-weight: 600;
  color: #475569;
}

.comment-card__content {
  flex: 1;
  margin-bottom: 20px;
}

.comment-text {
  color: $txt;
  line-height: 1.6;
  margin-bottom: 20px;
  font-size: 0.9375rem;
}

.pros-cons {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.pros,
.cons {
  display: flex;
  gap: 8px;
  font-size: 0.875rem;
  line-height: 1.5;
}

.label {
  font-weight: 600;
  white-space: nowrap;

  &.positive {
    color: #10b981;
  }

  &.negative {
    color: #ef4444;
  }
}

.value {
  color: #475569;
}

.comment-card__footer {
  display: flex;
  align-items: center;
  gap: 12px;
  padding-top: 16px;
  border-top: 1px solid #f1f5f9;
}

.helpful-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 20px;
  font-size: 0.875rem;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    background: #f1f5f9;
    border-color: #cbd5e1;
  }

  .count {
    font-weight: 600;
    color: #475569;
  }
}

.reply-btn {
  padding: 6px 12px;
  background: transparent;
  border: none;
  font-size: 0.875rem;
  color: #3b82f6;
  cursor: pointer;
  transition: color 0.2s ease;

  &:hover {
    color: #2563eb;
    text-decoration: underline;
  }
}

.view-all-container {
  text-align: center;
  margin-top: 40px;
}

@media (max-width: 768px) {
  .comments-section {
    padding: 48px 0;
  }

  .section-title {
    font-size: 2rem;
  }

  .swiper-button {
    display: none;
  }

  .swiper-container {
    margin: 0;
    padding: 0;
  }

  .comment-card {
    padding: 20px;
  }
}
</style>
